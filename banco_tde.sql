-- CRIACAO DA BASE DE DADOS
CREATE DATABASE CORRETORA;

-- USAR BASE DE DADOS
USE CORRETORA;

-- CRIAÇÃO DE TABELA FUNCIONÁRIO
CREATE TABLE FUNCIONARIO(
	ID_FUNCIONARIO INT PRIMARY KEY AUTO_INCREMENT,
    ID_GERENTE INT DEFAULT 1,
    NOME VARCHAR(50) NOT NULL,
    CPF CHAR(11) UNIQUE NOT NULL,
    TELEFONE CHAR(11) NOT NULL,
    RUA VARCHAR(50),
    CIDADE VARCHAR(50),
    ESTADO VARCHAR(50),
    PAIS VARCHAR(50),
    CEP CHAR(8)
);

-- INSERIR PRIMEIRO FUNCIONARIO
INSERT INTO 
	FUNCIONARIO (NOME, CPF, TELEFONE, RUA, CIDADE, ESTADO, PAIS, CEP)
VALUES
	('GUSTAVO PASQUA', '07756027523', '75991290503', 'RUA DA PENHA', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '44066126'),
    ('ERICK DAMASCENO', '12345678911', '75999992233', 'RUA DA CAIXA', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '44066123'),
    ('SAVIO GUIMARAES', '32153634144', '75993223421', 'RUA DA AGUA', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '44066124'),
    ('GABRIEL SANTOS', '42425678712', '75991290503', 'RUA DA PENHA', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '44066126'),
    ('LUAN LOPES', '12341223142', '75991290503', 'RUA 1', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '42232221'),
    ('GUILHERME BARBOSA', '42523455231', '75991290503', 'RUA 2', 'SALVADOR', 'BAHIA', 'BRASIL', '42313223'),
    ('CESAR CIELO', '52345623452', '75991290503', 'RUA 3', 'SERRINHA', 'BAHIA', 'BRASIL', '42523215'),
    ('PAULO TELES', '24523152353', '75991290503', 'RUA 4', 'CONCEICAO DE COITE', 'BAHIA', 'BRASIL', '33333321'),
    ('CAIO EDUARDO', '24515326341', '75991290503', 'RUA 5', 'CURITIBA', 'PARANA', 'BRASIL', '44066126'),
    ('ETEVALDO JUNIO', '53613412312', '75991290503', 'RUA 6', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '53423312'),
    ('GEAN TRABUCO', '42132132135', '75991290503', 'RUA SALVE', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '44422211'),
    ('THIAGO MARIANO', '63667889761', '75991290503', 'RUA SIM', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '55363563'),
    ('THIAGO OLIVEIRA', '53658900098', '75991290503', 'RUA CAIXA', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '53421314'),
    ('GUSTAVO SILVA', '53577788990', '75991290503', 'MARIA QUITERIA', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '25456343'),
    ('JOAO GABRIEL', '23242142156', '75991290503', 'GETULIO', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '23543247');
    
-- CRIAÇÃO TABELA GERENTE
CREATE TABLE GERENTE(
	ID_GERENTE INT PRIMARY KEY AUTO_INCREMENT,
    ID_FUNCIONARIO INT UNIQUE,
    FOREIGN KEY (ID_FUNCIONARIO) REFERENCES FUNCIONARIO (ID_FUNCIONARIO)
);

-- INSERIR PRIMEIRO GERENTE (QUE TAMBÉM É FUNCIONÁRIO)
INSERT INTO
	GERENTE (ID_FUNCIONARIO)
VALUES
	(1),
	(4),
    (8),
    (10);

-- TORNANDO ID_GERENTE CHAVE EXTRANGEIRA EM FUNCIONARIO - REFERENCIANDO GERENTE
ALTER TABLE FUNCIONARIO
ADD CONSTRAINT ID_GERENTE_FK
FOREIGN KEY (ID_GERENTE) REFERENCES GERENTE (ID_GERENTE);

-- CRIAR TABELA VENDEDOR
CREATE TABLE VENDEDOR (
	ID_VENDEDOR INT PRIMARY KEY AUTO_INCREMENT,
    ID_FUNCIONARIO INT UNIQUE,
    FOREIGN KEY (ID_FUNCIONARIO) REFERENCES FUNCIONARIO (ID_FUNCIONARIO)
);

-- DEPOIS CADASTRAR COMO VENDEDOR
INSERT INTO
	VENDEDOR (ID_FUNCIONARIO)
VALUES
	(2),
    (3),
    (5),
    (6),
    (7),
    (9),
    (11),
    (12),
    (13),
    (14),
    (15);
    
-- CRIAR TABELA SEGURADORA
CREATE TABLE SEGURADORA(
	ID_SEGURADORA INT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(60) NOT NULL
);

-- INSERIR SEGURADORAS
INSERT INTO
	SEGURADORA (NOME)
VALUES
	('PORTO SEGUROS'),
    ('AZUL SEGUROS'),
    ('BRADESCO SEGUROS'),
    ('LIBERTY SEGUROS');

-- CRIAR TABELA SEGURO
CREATE TABLE SEGURO(
	ID_SEGURO INT PRIMARY KEY AUTO_INCREMENT,
    ID_SEGURADORA INT,
    ID_CATEGORIA SMALLINT,
    PREMIO_TOTAL FLOAT(6,2),
    PREMIO_LIQUIDO FLOAT(6,2),
    FOREIGN KEY (ID_SEGURADORA) REFERENCES SEGURADORA (ID_SEGURADORA)
);

-- CRIAR TABELA CATEGORIA DE SEGURO
CREATE TABLE CATEGORIA(
	ID_CATEGORIA SMALLINT PRIMARY KEY AUTO_INCREMENT,
    NOME VARCHAR(50)
);

-- ADICIONAR FK DE CATEGORIA EM SEGURO
ALTER TABLE SEGURO
ADD CONSTRAINT FK_CATEGORIA
FOREIGN KEY (ID_CATEGORIA)
REFERENCES CATEGORIA (ID_CATEGORIA)
ON UPDATE CASCADE
ON DELETE CASCADE;

-- INSERT CATEGORIA
INSERT INTO
	CATEGORIA (NOME)
VALUES
	('AUTO'),
    ('DENTAL'),
    ('RESIDENCIAL'),
    ('VIDA');

-- INSERIR SEGUROS
INSERT INTO
	SEGURO (ID_SEGURADORA, ID_CATEGORIA, PREMIO_TOTAL, PREMIO_LIQUIDO)
VALUES
	(1,1,1000,890),
    (1,2,1200,980),
    (1,3,1500,1000),
    (1,4,700,579),
    (2,1,2390,1990),
    (2,2,2000,1750),
    (2,3,3210,2706),
    (2,4,1350,1150),
    (3,1,1234,1023),
    (3,2,1567,1355),
    (3,3,5000,4700),
    (3,4,600,530),
    (4,1,300,210),
    (4,2,700,550),
    (4,3,1000,920),
    (4,4,7000,6780);

-- CRIAR TABELA CLIENTE
CREATE TABLE CLIENTE(
    ID_CLIENTE INT PRIMARY KEY AUTO_INCREMENT,
    TELEFONE CHAR(11),
    EMAIL VARCHAR(50) UNIQUE
);

-- INSERIR NOVO CLIENTE
INSERT INTO
	CLIENTE (TELEFONE, EMAIL)
VALUES
	('75992233213', 'JOSESANTOS@GMAIL.COM'),
    ('75992233423', 'FAN@GMAIL.COM'),
    ('75992233535', 'UNEF@GMAIL.COM'),
    ('75992233646', 'MARIASANTOS@GMAIL.COM'),
    ('75934533646', 'CARLOSSOUZA@GMAIL.COM'),
    ('75975653646', 'LOJASMAIA@GMAIL.COM'),
    ('75977686546', 'ELETRONICOSECIA@GMAIL.COM'),
	('75972324546', 'LOJAOIRARA@GMAIL.COM'),
    ('75945424546', 'MARCELOFREITAS@GMAIL.COM'),
    ('75243345546', 'SAVIOMAGALHAES@GMAIL.COM'),
    ('75988888046', 'LOJAOFEIRENSE@GMAIL.COM'),
    ('75985345646', 'JURACISOUZA@GMAIL.COM'),
    ('75983435366', 'NEYMARPEREIRA@GMAIL.COM'),
    ('75988787946', 'SATIRODIASATACADAO@GMAIL.COM'),
    ('75982325666', 'LORIVALDOGOMES@GMAIL.COM');

-- ATRIBUIR PESSOA FÍSICA OU PESSOA JURÍDICA AO CLIENTE
CREATE TABLE PESSOA_FISICA(
	CPF CHAR(11) PRIMARY KEY,
    NOME VARCHAR(50),
    ID_CLIENTE INT,
	FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (ID_CLIENTE)
);

-- INSERIR PESSOA_FÍSICA (JÁ EXISTE NA TABELA CLIENTE)
INSERT INTO
	PESSOA_FISICA (CPF, NOME, ID_CLIENTE)
VALUES
	('09876567865', 'JOSE SANTOS DE JESUS', 1),
    ('09874242221', 'MARIA SANTOS DE JESUS', 4),
    ('12412312556', 'CARLOS SOUZA ALVES', 5),
    ('52245536768', 'MARCELO FREITAS AMORIM', 9),
    ('42142141245', 'SAVIO MAGALHAES TORRES', 10),
    ('34264364366', 'JURACI SOUZA DAMASCENO', 12),
    ('64536464366', 'NEYMAR PEREIRA JUNIOR', 13),
    ('76457575474', 'LORIVALDO GOMES SILVA', 15);
    
-- CRIAR TABELA PESSOA_JURIDICA
CREATE TABLE PESSOA_JURIDICA(
	CNPJ CHAR(14) PRIMARY KEY,
	RAZAO_SOCIAL VARCHAR(50),
	ID_CLIENTE INT,
	FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (ID_CLIENTE)
);

-- INSERIR PESSOA JURÍDICA (JÁ EXISTE NA TABELA CLIENTE)
INSERT INTO
	PESSOA_JURIDICA (CNPJ, RAZAO_SOCIAL, ID_CLIENTE)
VALUES
	('09876567000150', 'CENTRO UNIVERSITARIO NOBRE LTDA', 2),
    ('42142424000134', 'UNIDADE DE ENSINO SUPERIOR DE FEIRA DE SANTANA', 3),
    ('42142233000142', 'LOJAS MAIA LTDA', 6),
    ('46363633000164', 'ELETRONICOS E CIA LTDA', 7),
    ('88692233000111', 'LOJAO IRARA', 8),
    ('92842233000142', 'LOJAO FEIRENSE', 11),
    ('12342233000147', 'SATIRO DIAS ATACADAO', 14);
    
-- CRIAR TABELA AUTOMÓVEL
CREATE TABLE AUTOMOVEL(
	ID_AUTO INT PRIMARY KEY AUTO_INCREMENT,
    ID_CLIENTE INT,
    CHASSI VARCHAR(17) UNIQUE,
    MODELO VARCHAR(50),
    MARCA VARCHAR(50),
    ANO INT,
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (ID_CLIENTE)
);

-- INSERIR AUTOMOVEIS
INSERT INTO
	AUTOMOVEL (ID_CLIENTE, CHASSI, MODELO, MARCA, ANO)
VALUES
	(4, '8wNp7ZCk2YQdX7555', 'COROLLA XRS', 'TOYOTA', 2018),
    (7, '2vKj6TRf9XMeZ6222', 'CIVIC EX', 'HONDA', 2019),
    (5, '9tZs3YGw1ROvE8444', 'GOLF TSI', 'VOLKSWAGEN', 2016),
    (6, '5mGh9PIu3SDLU0111', 'FOCUS TITANIUM', 'FORD', 2020),
    (13, '3kFo8LNh4RYpM3777', 'CAMRY XLE', 'TOYOTA', 2017),
    (12, '7rTm2OJv5PAzW9333', '3 SERIES M SPORT', 'BMW', 2018),
    (10, '1pAb4QAz5ZHkY6999', 'FUSION TITANIUM', 'FORD', 2019),
    (2, '6sFd3XBe8CLuV8222', 'ALTIMA SL', 'NISSAN', 2020);

-- CRIAR TABELA RESIDENCIA
CREATE TABLE RESIDENCIA(
	ID_RESIDENCIA INT PRIMARY KEY AUTO_INCREMENT,
    ID_CLIENTE INT,
    RUA VARCHAR(50),
    BAIRRO VARCHAR(50),
    CIDADE VARCHAR(50),
    ESTADO VARCHAR(50),
    PAIS VARCHAR(50),
    CEP CHAR(8),
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (ID_CLIENTE)
);

-- INSERIR RESIDENCIAS
INSERT INTO
	RESIDENCIA (ID_CLIENTE, RUA, BAIRRO, CIDADE, ESTADO, PAIS, CEP)
VALUES
	(3, 'AVENIDA PRINCIPAL', 'CENTRO', 'RIO DE JANEIRO', 'RIO DE JANEIRO', 'BRASIL', '28475236'),
    (6, 'RUA DAS FLORES', 'JARDIM BOTÂNICO', 'PORTO ALEGRE', 'RIO GRANDE DO SUL', 'BRASIL', '98475233'),
    (11, 'AVENIDA CENTRAL', 'CENTRO', 'SÃO PAULO', 'SÃO PAULO', 'BRASIL', '98563214'),
    (4, 'RUA PRINCIPAL', 'CENTRO', 'BELO HORIZONTE', 'MINAS GERAIS', 'BRASIL', '38785569'),
    (5, 'AVENIDA DA LIBERDADE', 'BAIRRO NOVO', 'SALVADOR', 'BAHIA', 'BRASIL', '44587236'),
    (10, 'RUA DA CAIXA', 'FEIRA DE SANTANA', 'FEIRA DE SANTANA', 'BAHIA', 'BRASIL', '44087412'),
    (9, 'RUA DOS JARDINS', 'ALTO DA XV', 'CURITIBA', 'PARANÁ', 'BRASIL', '86653217'),
    (5, 'RUA PRINCIPAL', 'BOA VIAGEM', 'RECIFE', 'PERNAMBUCO', 'BRASIL', '50009657'),
    (12, 'AVENIDA CENTRO', 'CENTRO', 'MANAUS', 'AMAZONAS', 'BRASIL', '69058744'),
    (7, 'RUA PRINCIPAL', 'ASA SUL', 'BRASÍLIA', 'DISTRITO FEDERAL', 'BRASIL', '72365448'),
    (15, 'RUA FERNANDINHO', 'COITEZINHO', 'CONCEICAO DO COITE', 'BAHIA', 'BRASIL', '44874000'),
    (1, 'RUA DANTAS', 'POVOADO SANTO ANTONIO', 'IRARA', 'BAHIA', 'BRASIL', '44852321');

-- CRIAR TABELA CONTRATO
CREATE TABLE CONTRATO(
    ID_CONTRATO INT PRIMARY KEY AUTO_INCREMENT,
    ID_CLIENTE INT,
    ID_VENDEDOR INT,
    ID_SEGURO INT,
    DATA_INICIO DATE,
    DATA_FIM DATE,
    FOREIGN KEY (ID_CLIENTE) REFERENCES CLIENTE (ID_CLIENTE),
    FOREIGN KEY (ID_VENDEDOR) REFERENCES VENDEDOR (ID_VENDEDOR),
    FOREIGN KEY (ID_SEGURO) REFERENCES SEGURO (ID_SEGURO)
);

-- INSERIR CONTRATOS
INSERT INTO
	CONTRATO (ID_CLIENTE, ID_VENDEDOR, ID_SEGURO, DATA_INICIO, DATA_FIM)
VALUES
	(4, 1, 1, CURDATE(), DATE_ADD(CURDATE(), INTERVAL 1 YEAR)),
    (7, 1, 5, '2023-02-03', '2024-02-03'),
    (5, 3, 8, '2023-02-03', '2024-02-03'),
    (6, 4, 13, '2023-02-03', '2023-07-22'),
    (13, 5, 5, '2023-01-10', '2024-01-10'),
    (12, 11, 9, '2022-10-17', '2023-10-17'),
    (10, 2, 1, '2022-11-07', '2023-11-07'),
    (2, 9, 13, '2023-03-05', '2024-03-05'),
    (3, 11, 3, '2023-04-29', '2024-04-29'),
    (6, 2, 7, '2023-01-01', '2024-01-01'),
    (11, 3, 11, '2022-08-12', '2023-08-12'),
    (4, 1, 15, '2023-01-14', '2024-01-14'),
    (5, 9, 11, '2023-02-28', '2024-02-28'),
    (10, 5, 15, '2022-06-12', '2023-06-12'),
    (9, 4, 3, '2023-02-26', '2024-02-26'),
    (5, 11, 7, '2023-02-26', '2023-09-15'),
    (12, 10, 3, '2023-02-26', '2024-02-26'),
    (7, 3, 11, '2023-02-26', '2024-02-26'),
    (15, 2, 7, '2023-02-26', '2024-02-26'),
    (1, 11, 11, '2023-02-26', '2024-02-26'),
    (3, 10, 2, '2023-02-26', '2024-02-26'),
    (5, 9, 6, '2023-02-26', '2024-02-26'),
    (6, 8, 10, '2023-02-26', '2024-02-26'),
    (7, 7, 14, '2023-02-26', '2024-02-26'),
    (8, 6, 2, '2023-02-26', '2024-02-26'),
    (9, 5, 4, '2023-02-26', '2024-02-26'),
    (10, 4, 8, '2023-02-26', '2024-02-26'),
    (11, 3, 12, '2023-02-26', '2024-02-26'),
    (12, 2, 16, '2023-02-26', '2024-02-26'),
    (13, 1, 12, '2023-02-26', '2024-02-26'),
    (14, 7, 8, '2023-02-26', '2024-02-26'),
    (15, 9, 6, '2023-02-26', '2024-02-26');

-- CONSULTAS

-- QUAIS CONTRATOS DOS CLIENTES PESSOA FÍSICA , DE QUAL SEGURADORA E QUANTO CUSTA
SELECT PESSOA_FISICA.NOME, FUNCIONARIO.NOME AS VENDEDOR, CATEGORIA.NOME AS CATEGORIA, SEGURADORA.NOME AS SEGURADORA, SEGURO.PREMIO_TOTAL AS VALOR FROM CONTRATO
	INNER JOIN CLIENTE ON CLIENTE.ID_CLIENTE = CONTRATO.ID_CLIENTE
    INNER JOIN SEGURO ON SEGURO.ID_SEGURO = CONTRATO.ID_SEGURO
    INNER JOIN VENDEDOR ON VENDEDOR.ID_VENDEDOR = CONTRATO.ID_VENDEDOR
    INNER JOIN PESSOA_FISICA ON PESSOA_FISICA.ID_CLIENTE = CLIENTE.ID_CLIENTE
    INNER JOIN CATEGORIA ON CATEGORIA.ID_CATEGORIA = SEGURO.ID_CATEGORIA
    INNER JOIN SEGURADORA ON SEGURADORA.ID_SEGURADORA = SEGURO.ID_SEGURADORA
    INNER JOIN FUNCIONARIO ON FUNCIONARIO.ID_FUNCIONARIO = VENDEDOR.ID_FUNCIONARIO
UNION ALL
-- QUAIS CONTRATOS DOS CLIENTES PESSOA JURÍDICA , DE QUAL SEGURADORA E QUANTO CUSTA
SELECT PESSOA_JURIDICA.RAZAO_SOCIAL, FUNCIONARIO.NOME AS VENDEDOR, CATEGORIA.NOME AS CATEGORIA, SEGURADORA.NOME AS SEGURADORA, SEGURO.PREMIO_TOTAL AS VALOR FROM CONTRATO
	INNER JOIN CLIENTE ON CLIENTE.ID_CLIENTE = CONTRATO.ID_CLIENTE
    INNER JOIN SEGURO ON SEGURO.ID_SEGURO = CONTRATO.ID_SEGURO
    INNER JOIN VENDEDOR ON VENDEDOR.ID_VENDEDOR = CONTRATO.ID_VENDEDOR
    INNER JOIN PESSOA_JURIDICA ON PESSOA_JURIDICA.ID_CLIENTE = CLIENTE.ID_CLIENTE
    INNER JOIN CATEGORIA ON CATEGORIA.ID_CATEGORIA = SEGURO.ID_CATEGORIA
    INNER JOIN SEGURADORA ON SEGURADORA.ID_SEGURADORA = SEGURO.ID_SEGURADORA
    INNER JOIN FUNCIONARIO ON FUNCIONARIO.ID_FUNCIONARIO = VENDEDOR.ID_FUNCIONARIO;
    
-- RESIDENCIAS DE PESSOAS FÍSICAS EM ORDEM ALFABÉTICA DO NOME DO CLIENTE
SELECT R.ID_RESIDENCIA AS RESIDENCIA, C.ID_CLIENTE AS CLIENTE, PF.NOME, R.RUA, R.BAIRRO, R.CIDADE, R.ESTADO, R.PAIS FROM RESIDENCIA R
	INNER JOIN CLIENTE C ON C.ID_CLIENTE = R.ID_CLIENTE
	INNER JOIN PESSOA_FISICA PF ON PF.ID_CLIENTE = C.ID_CLIENTE
ORDER BY PF.NOME;

-- RESIDENCIAS DE PESSOAS JURÍDICAS EM ORDEM ALFABÉTICA DE CIDADES
SELECT R.ID_RESIDENCIA AS RESIDENCIA, C.ID_CLIENTE AS CLIENTE, PJ.RAZAO_SOCIAL, R.RUA, R.BAIRRO, R.CIDADE, R.ESTADO, R.PAIS FROM RESIDENCIA R
	INNER JOIN CLIENTE C ON C.ID_CLIENTE = R.ID_CLIENTE
	INNER JOIN PESSOA_JURIDICA PJ ON PJ.ID_CLIENTE = C.ID_CLIENTE
ORDER BY R.CIDADE;
    
-- SOMA DO VALOR RECEBIDO DE TODOS OS CONTRATOS
SELECT SUM(PREMIO_LIQUIDO) AS TOTAL FROM SEGURO
	INNER JOIN CONTRATO ON CONTRATO.ID_SEGURO = SEGURO.ID_SEGURO;
    
-- SEGUROS DA BRADESCO SEGUROS QUE FORAM CONTRATADOS EM 2023, COM DATA DE VIGÊNCIA
SELECT PESSOA_FISICA.NOME, CLIENTE.TELEFONE, CLIENTE.EMAIL, CONTRATO.DATA_INICIO AS VIGENCIA FROM CONTRATO
	INNER JOIN SEGURO ON SEGURO.ID_SEGURO = CONTRATO.ID_SEGURO
    INNER JOIN CLIENTE ON CLIENTE.ID_CLIENTE = CONTRATO.ID_CLIENTE
    INNER JOIN PESSOA_FISICA ON PESSOA_FISICA.ID_CLIENTE = CLIENTE.ID_CLIENTE
WHERE CONTRATO.DATA_INICIO > '2023-01-01'
UNION ALL
SELECT PESSOA_JURIDICA.RAZAO_SOCIAL, CLIENTE.TELEFONE, CLIENTE.EMAIL, CONTRATO.DATA_INICIO AS VIGENCIA FROM CONTRATO
	INNER JOIN SEGURO ON SEGURO.ID_SEGURO = CONTRATO.ID_SEGURO
    INNER JOIN CLIENTE ON CLIENTE.ID_CLIENTE = CONTRATO.ID_CLIENTE
    INNER JOIN PESSOA_JURIDICA ON PESSOA_JURIDICA.ID_CLIENTE = CLIENTE.ID_CLIENTE
WHERE CONTRATO.DATA_INICIO > '2023-01-01';

-- VERIFICAR CONTRATOS QUE VENCEM NO MÊS DE JUNHO
SELECT PESSOA_FISICA.NOME, CLIENTE.TELEFONE, CLIENTE.EMAIL, CONTRATO.DATA_FIM AS VIGENCIA FROM CONTRATO
	INNER JOIN SEGURO ON SEGURO.ID_SEGURO = CONTRATO.ID_SEGURO
    INNER JOIN CLIENTE ON CLIENTE.ID_CLIENTE = CONTRATO.ID_CLIENTE
    INNER JOIN PESSOA_FISICA ON PESSOA_FISICA.ID_CLIENTE = CLIENTE.ID_CLIENTE
WHERE CONTRATO.DATA_FIM BETWEEN '2023-06-01' AND '2023-06-30'
UNION ALL
SELECT PESSOA_JURIDICA.RAZAO_SOCIAL, CLIENTE.TELEFONE, CLIENTE.EMAIL, CONTRATO.DATA_INICIO AS VIGENCIA FROM CONTRATO
	INNER JOIN SEGURO ON SEGURO.ID_SEGURO = CONTRATO.ID_SEGURO
    INNER JOIN CLIENTE ON CLIENTE.ID_CLIENTE = CONTRATO.ID_CLIENTE
    INNER JOIN PESSOA_JURIDICA ON PESSOA_JURIDICA.ID_CLIENTE = CLIENTE.ID_CLIENTE
WHERE CONTRATO.DATA_FIM BETWEEN '2023-06-01' AND '2023-06-30';

-- SOMA DOS VALORES DOS SEGUROS VENDIDOS PELA CATEGORIA
SELECT CAT.NOME AS CATEGORIA, SUM(S.PREMIO_LIQUIDO) AS VALOR FROM CONTRATO C
	INNER JOIN SEGURO S ON S.ID_SEGURO = C.ID_SEGURO
    INNER JOIN CATEGORIA CAT ON CAT.ID_CATEGORIA = S.ID_CATEGORIA
GROUP BY CAT.NOME;

-- CATEGORIA DE SEGUROS QUE VENDERAM MAIS DE 10.000,00
SELECT CAT.NOME AS CATEGORIA, SUM(S.PREMIO_LIQUIDO) AS VALOR FROM CONTRATO C
	INNER JOIN SEGURO S ON S.ID_SEGURO = C.ID_SEGURO
    INNER JOIN CATEGORIA CAT ON CAT.ID_CATEGORIA = S.ID_CATEGORIA
GROUP BY CAT.NOME
HAVING SUM(S.PREMIO_LIQUIDO) > 10000;

-- VALORES SOMADOS DE CADA CLIENTE
SELECT PF.NOME AS NOME, SUM(SEG.PREMIO_TOTAL) AS TOTAL FROM CONTRATO CON
	INNER JOIN SEGURO SEG ON SEG.ID_SEGURO = CON.ID_SEGURO
    INNER JOIN CLIENTE CLI ON CLI.ID_CLIENTE = CON.ID_CLIENTE
    INNER JOIN PESSOA_FISICA PF ON PF.ID_CLIENTE = CLI.ID_CLIENTE
GROUP BY PF.NOME
UNION ALL
SELECT PJ.RAZAO_SOCIAL AS NOME, SUM(SEG.PREMIO_TOTAL) AS TOTAL FROM CONTRATO CON
	INNER JOIN SEGURO SEG ON SEG.ID_SEGURO = CON.ID_SEGURO
    INNER JOIN CLIENTE CLI ON CLI.ID_CLIENTE = CON.ID_CLIENTE
    INNER JOIN PESSOA_JURIDICA PJ ON PJ.ID_CLIENTE = CLI.ID_CLIENTE
GROUP BY PJ.RAZAO_SOCIAL;

-- SEGURO QUE POSSUI VALOR MAIS ALTO
SELECT CAT.NOME AS SEGURO, SGA.NOME AS SEGURADORA, SEG.PREMIO_TOTAL AS VALOR FROM SEGURO SEG
	INNER JOIN SEGURADORA SGA ON SGA.ID_SEGURADORA = SEG.ID_SEGURADORA
    INNER JOIN CATEGORIA CAT ON CAT.ID_CATEGORIA = SEG.ID_CATEGORIA
WHERE SEG.PREMIO_TOTAL = (SELECT MAX(PREMIO_TOTAL) FROM SEGURO);

-- SEGURO QUE POSSUI VALOR MAIS BAIXO
SELECT CAT.NOME AS SEGURO, SGA.NOME AS SEGURADORA, SEG.PREMIO_TOTAL AS VALOR FROM SEGURO SEG
	INNER JOIN SEGURADORA SGA ON SGA.ID_SEGURADORA = SEG.ID_SEGURADORA
    INNER JOIN CATEGORIA CAT ON CAT.ID_CATEGORIA = SEG.ID_CATEGORIA
WHERE SEG.PREMIO_TOTAL = (SELECT MIN(PREMIO_TOTAL) FROM SEGURO);

-- MEDIA DE PREÇOS DE SEGUROS DA SEGURADORA BRADESCO (3)
SELECT SEGURADORA.NOME, AVG(PREMIO_TOTAL) FROM SEGURO WHERE ID_SEGURADORA = 3;

-- QUANTOS CLIENTES EXISTEM NA BASE DE DADOS
SELECT COUNT(ID_CLIENTE) FROM CLIENTE;

-- IDS DE FUNCIONARIOS QUE COMEÇAM COM A LETRA G
SELECT ID_FUNCIONARIO AS ID, NOME FROM FUNCIONARIO
WHERE NOME LIKE 'G%';

-- IDS DE FUNCIONARIOS QUE NAO TERMINAM COM A LETRA O
SELECT ID_FUNCIONARIO AS ID, NOME FROM FUNCIONARIO
WHERE NOME NOT LIKE '%O';

-- CONTAGEM DE VENDAS POR VENDEDOR
SELECT ID_VENDEDOR, COUNT(ID_VENDEDOR) FROM CONTRATO
GROUP BY ID_VENDEDOR;  

